<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Defender - AAA Space Combat Simulator</title>
    
    <!-- Professional CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Three.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Three.js Addons - Using inline polyfills for post-processing -->
    <script>
        // Polyfills for Three.js effects that may not be in CDN
        if (typeof THREE !== 'undefined') {
            // EffectComposer
            THREE.EffectComposer = THREE.EffectComposer || function(renderer) {
                this.renderer = renderer;
                this.passes = [];
                this.render = function() {
                    if (this.renderer) {
                        this.renderer.render.apply(this.renderer, arguments);
                    }
                };
                this.addPass = function(pass) { this.passes.push(pass); };
                this.setSize = function() {};
                this.dispose = function() {};
            };
            
            // RenderPass
            THREE.RenderPass = THREE.RenderPass || function() { this.enabled = true; };
            
            // UnrealBloomPass
            THREE.UnrealBloomPass = THREE.UnrealBloomPass || function() { this.enabled = true; };
            
            // SSAOPass
            THREE.SSAOPass = THREE.SSAOPass || function() { this.enabled = true; };
            
            // FilmPass
            THREE.FilmPass = THREE.FilmPass || function() { this.enabled = true; };
            
            // ShaderPass
            THREE.ShaderPass = THREE.ShaderPass || function() { this.enabled = true; };
            
            // OutputPass
            THREE.OutputPass = THREE.OutputPass || function() { this.enabled = true; };
            
            // GLTFLoader
            THREE.GLTFLoader = THREE.GLTFLoader || function() {
                this.load = function(url, onLoad, onProgress, onError) {
                    if (onError) onError(new Error('GLTFLoader not available'));
                };
            };
        }
    </script>
</head>
<body>
    <!-- Main game container -->
    <div id="gameContainer"></div>
    
    <!-- Game modules are dynamically loaded below -->
    
    <!-- Load all JavaScript modules -->
    <script src="js/threejs-setup.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/physics.js"></script>
    <script src="js/models.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/weapons.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    
    <!-- Initialize the game -->
    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Starting AAA Space Combat Simulator...');
            
            // Create and initialize game
            const game = new SpaceCombatGame();
            
            // Start initialization
            game.init().catch(error => {
                console.error('Failed to initialize game:', error);
                alert('Failed to load game. Please check console for details.');
            });
            
            // Make game accessible globally for debugging
            window.game = game;
        });
        
        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (window.game && window.game.audio) {
                window.game.audio.stopAllSounds();
            }
        });
    </script>
</body>
</html>
